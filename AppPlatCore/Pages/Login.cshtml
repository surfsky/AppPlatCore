@page
@model App.Pages.LoginModel

@section head {
    <script>
        if (top.window != window) {
            top.window.location.href = "/Login";
        }
    </script>

    <style>
        body {
            background-image: url(./res/themes/image_blue_moon/moon.jpg);
            background-size: cover;
            background-position: center 0;
            background-repeat: no-repeat;
        }

        .login-image {
            background-color: #efefef;
            border-right: solid 1px #ddd;
            margin-bottom: 0 !important;
            height: 250;
        }
        .login-image img {
            width: 160px;
            height: 160px;
            padding: 10px;
        }
        .f-mask.f-widget.f-widget-content {
            background-image: linear-gradient(180deg, rgb(5, 39, 103) 0%, #3a0647 70%) !important;
        }

    </style>
}

@section body {
    <f:Window ID="Window1" IsModal="true" Hidden="false" EnableClose="false" EnableMaximize="false" WindowPosition="GoldenSection" Icon="Key"
              Title="@Model.WinTitle" Layout="HBox" BoxConfigAlign="Stretch" BoxConfigPosition="Start" Width="600">
        <Items>
            <f:Image ID="imageLogin" ImageUrl="~/res/images/login/login_2.png" CssClass="login-image" ImageHeight="320"/>
            <f:SimpleForm ID="SimpleForm1" LabelAlign="Top" BoxFlex="1" BodyPadding="30 20" ShowBorder="false" ShowHeader="false">
                <Items>
                    <f:TextBox ID="userName" FocusOnPageLoad="true" Label="帐号" Required="true" ShowRedStar="true" Text="" />
                    <f:TextBox ID="password" TextMode="Password" Required="true" ShowRedStar="true" Label="密码" Text="" />
                    <f:TextBox ID="verifyCode" Required="true" ShowRedStar="true" Label="验证码" Text="" />
                    <f:Image ID="imgVerify" ImageUrl="/HttpApi/Common/VerifyImage" ImageWidth="150" ImageHeight="39" ToolTip="" CssStyle="cursor: point;">
                        <Listeners>
                            <f:Listener Event="click" Handler="resetVerifyImg();"></f:Listener>
                        </Listeners>
                    </f:Image>
                </Items>
            </f:SimpleForm>
        </Items>
        <Toolbars>
            <f:Toolbar Position="Bottom">
                <Items>
                    <f:ToolbarFill/>
                    <f:Button ID="btnSubmit" Icon="LockOpen" Type="Submit" ValidateForms="SimpleForm1" OnClickFields="SimpleForm1" OnClick="@Url.Handler("btnSubmit_Click")" Text="登陆"></f:Button>
                </Items>
            </f:Toolbar>
        </Toolbars>
    </f:Window>

}

@section script{
    <!--script src="res/js/jquery-3.4.1.js"></!script-->
    <script>
        F.ready(function () {
            // 点击图片刷新，摆不平
            var el1 = document.getElementById("imgVerify-inputEl");
            var el2 = F.ui.imgVerify.getAttrEl();
            el1.addEventListener('click', resetVerifyImg(), true);
            el1.style.cursor = "point";
            //$("#imgVerify-inputEl").on('click', resetVerifyImg());
        });


        // 重置验证码
        function resetVerifyImg() {
            var url = "/HttpApi/Common/VerifyImage?" + Math.random();  // 避免某些浏览器会缓存图片
            //var el1 = document.getElementById("imgVerify-inputEl");
            var el2 = F.ui.imgVerify.getAttrEl();
            el2.attr('src', url);
            //F.ui.imgVerify.getAttrEl().attr('src', url);
            //$("#imgVerify").attr('src', url);
            //$("#imgVerify-inputEl").attr('src', url);
        }

    </script>
}